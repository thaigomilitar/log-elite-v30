<script>
    // ... lógica de captura ...
    async function executarIA() {
        if (processando || !API_KEY) return;
        processando = true;
        document.getElementById('status').innerText = "IA ANALISANDO...";

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-lite-preview-02-05:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: "Extraia Nome e Endereço desta etiqueta em JSON." }, { inline_data: { mime_type: "image/jpeg", data: base64 } }] }]
                })
            });

            const data = await response.json();
            
            // Se o erro for de cota (limite de velocidade), avisamos o usuário
            if (data.error && data.error.code === 429) {
                document.getElementById('status').innerText = "AGUARDE 10s (LIMITE DE COTA)";
                return;
            }

            if (data.error) throw new Error(data.error.message);
            // ... resto da lógica de sucesso ...
        } catch (err) {
            document.getElementById('status').innerText = "TENTANDO RECONECTAR...";
        } finally {
            setTimeout(() => { processando = false; }, 3000); // Espera 3s entre tentativas
        }
    }
</script>
